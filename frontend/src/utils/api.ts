import type { User, AuthResponse, Passage, AnswerSubmission, SubmissionResult, Progress } from '@/types';
const b=typeof window!=='undefined'?'http://localhost:3001/api':(process.env.NEXT_PUBLIC_API_URL||'http://localhost:3001/api');
console.log('API URL:',b);
console.log('Environment variables:',{NEXT_PUBLIC_API_URL:process.env.NEXT_PUBLIC_API_URL, NODE_ENV:process.env.NODE_ENV});
const h=()=>{const t=typeof window!=='undefined'?localStorage.getItem('token'):null;return t?{Authorization:`Bearer ${t}`}:{};};
export const apiClient={async request<T>(e:string,o:RequestInit={}):Promise<T>{if(!b){throw new Error('API base URL not configured');}const u=`${b}${e}`;console.log('Making request to:',u,'Base URL:',b,'Endpoint:',e);const a=h();const c:RequestInit={headers:{'Content-Type':'application/json',...(a as Record<string,string>),...(o.headers as Record<string,string>)},...o};console.log('Request config:',c);try{const r=await fetch(u,c);if(!r.ok){const e=await r.json().catch(()=>({message:'Network error'}));console.log('Request failed:',r.status,e);throw new Error(e.message||`HTTP ${r.status}`);}return r.json();}catch(fetchError){console.error('Fetch error:',fetchError);if(fetchError instanceof TypeError&&fetchError.message.includes('fetch')){throw new Error('Network error: Unable to connect to server. Please check if the backend is running.');}throw fetchError;}},get:<T>(e:string)=>apiClient.request<T>(e),post:<T>(e:string,d:unknown)=>apiClient.request<T>(e,{method:'POST',body:JSON.stringify(d)}),put:<T>(e:string,d:unknown)=>apiClient.request<T>(e,{method:'PUT',body:JSON.stringify(d)}),delete:<T>(e:string)=>apiClient.request<T>(e,{method:'DELETE'})};
export const authAPI={login:(e:string,p:string)=>apiClient.post<AuthResponse>('/auth/login',{email:e,password:p}),register:(d:{firstName:string;lastName:string;email:string;password:string})=>apiClient.post<AuthResponse>('/auth/register',d),logout:()=>{if(typeof window!=='undefined'){localStorage.removeItem('token');}},getProfile:()=>apiClient.get<User>('/auth/profile'),updateProfile:(d:{firstName:string;lastName:string;email:string})=>apiClient.put<User>('/auth/profile',d)};
export const passageAPI={getAll:()=>apiClient.get<Passage[]>('/passages'),getById:(i:string)=>apiClient.get<Passage>(`/passages/${i}`),submitAnswer:(i:string,a:AnswerSubmission)=>apiClient.post<SubmissionResult>(`/passages/${i}/submit`,a),getProgress:()=>apiClient.get<Progress>('/passages/progress')};